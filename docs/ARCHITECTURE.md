# ğŸ—ï¸ ARCHITECTURE - SYSTÃˆME D'AUTHENTIFICATION OPTIMISÃ‰

## ğŸ“Š FLUX DE DONNÃ‰ES

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    APPLICATION NEXT.JS                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  COUCHE CLIENT (React)                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚                  AuthProvider                         â”‚       â”‚
â”‚  â”‚                                                       â”‚       â”‚
â”‚  â”‚  State:                                              â”‚       â”‚
â”‚  â”‚  â”œâ”€ user: User | null                               â”‚       â”‚
â”‚  â”‚  â”œâ”€ isLoading: boolean                              â”‚       â”‚
â”‚  â”‚  â”œâ”€ isLoggingOut: boolean âœ¨ NOUVEAU                â”‚       â”‚
â”‚  â”‚  â””â”€ isAuthenticated: boolean                        â”‚       â”‚
â”‚  â”‚                                                       â”‚       â”‚
â”‚  â”‚  MÃ©thodes:                                          â”‚       â”‚
â”‚  â”‚  â”œâ”€ login(email, password)                          â”‚       â”‚
â”‚  â”‚  â”œâ”€ logout() â† OPTIMISÃ‰E                            â”‚       â”‚
â”‚  â”‚  â””â”€ checkAuth()                                     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚           â–²                      â–²                              â”‚
â”‚           â”‚                      â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ DashboardLayoutâ”‚    â”‚ Sidebar Component  â”‚                  â”‚
â”‚  â”‚                â”‚    â”‚ (ProtectedRoute)  â”‚                  â”‚
â”‚  â”‚ - GÃ¨re loading â”‚    â”‚                    â”‚                  â”‚
â”‚  â”‚ - Protection   â”‚    â”‚ - Bouton logout    â”‚                  â”‚
â”‚  â”‚ - Layouts      â”‚    â”‚ - Disabled state   â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚           â”‚                      â”‚                              â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                      â”‚                                          â”‚
â”‚                      â–¼                                          â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚           â”‚   Children Componentsâ”‚                              â”‚
â”‚           â”‚   - Page content    â”‚                              â”‚
â”‚           â”‚   - Protected routes â”‚                              â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    COUCHE RÃ‰SEAU (HTTP)                         â”‚
â”‚                                                                  â”‚
â”‚  LOGIN FLOW:                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ 1. Client: POST /api/auth/login                   â”‚        â”‚
â”‚  â”‚    â†’ { email, motDePasse }                        â”‚        â”‚
â”‚  â”‚                                                     â”‚        â”‚
â”‚  â”‚ 2. Server: Valider credentials                    â”‚        â”‚
â”‚  â”‚    â†’ GÃ©nÃ©rer JWT token                            â”‚        â”‚
â”‚  â”‚    â†’ Set-Cookie: token                            â”‚        â”‚
â”‚  â”‚    â† Response 200 OK                              â”‚        â”‚
â”‚  â”‚                                                     â”‚        â”‚
â”‚  â”‚ 3. Client: GET /api/auth/me                       â”‚        â”‚
â”‚  â”‚    â†’ Cookie: token (auto)                         â”‚        â”‚
â”‚  â”‚    â† Utilisateur + Role + Permissions             â”‚        â”‚
â”‚  â”‚                                                     â”‚        â”‚
â”‚  â”‚ 4. State Update:                                   â”‚        â”‚
â”‚  â”‚    setUser(userData)                              â”‚        â”‚
â”‚  â”‚    setIsAuthenticated(true)                       â”‚        â”‚
â”‚  â”‚    â†’ Render DashboardLayout                       â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                  â”‚
â”‚  LOGOUT FLOW (OPTIMISÃ‰):                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ 1. Client: Click "DÃ©connexion"                    â”‚        â”‚
â”‚  â”‚    â†“                                                â”‚        â”‚
â”‚  â”‚ 2. setIsLoggingOut(true) âœ¨ IMMÃ‰DIAT              â”‚        â”‚
â”‚  â”‚    setUser(null) âœ¨ IMMÃ‰DIAT                      â”‚        â”‚
â”‚  â”‚    â†’ Loader s'affiche                             â”‚        â”‚
â”‚  â”‚    â†’ Bouton dÃ©sactivÃ©                             â”‚        â”‚
â”‚  â”‚    â†“ (EN ARRIÃˆRE-PLAN)                            â”‚        â”‚
â”‚  â”‚ 3. POST /api/auth/logout                          â”‚        â”‚
â”‚  â”‚    â†’ Delete-Cookie: token                         â”‚        â”‚
â”‚  â”‚    â† Response 200 OK                              â”‚        â”‚
â”‚  â”‚    â†“                                                â”‚        â”‚
â”‚  â”‚ 4. router.refresh() + router.push('/login')       â”‚        â”‚
â”‚  â”‚    â†’ Redirection                                   â”‚        â”‚
â”‚  â”‚                                                     â”‚        â”‚
â”‚  â”‚ â±ï¸ Timeline:                                        â”‚        â”‚
â”‚  â”‚ 0ms   : Click logout                               â”‚        â”‚
â”‚  â”‚ 1ms   : State update (user = null)                â”‚        â”‚
â”‚  â”‚ 10ms  : Loader visible                            â”‚        â”‚
â”‚  â”‚ 100ms : Serveur logout complÃ©tÃ©e                 â”‚        â”‚
â”‚  â”‚ 150ms : Redirection /login                        â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              COUCHE API (Routes Next.js)                        â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ /api/auth/                                      â”‚            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚                                                 â”‚            â”‚
â”‚  â”‚ ğŸ“ /login                                       â”‚            â”‚
â”‚  â”‚  â”œâ”€ POST { email, motDePasse }                 â”‚            â”‚
â”‚  â”‚  â”œâ”€ Valider credentials                        â”‚            â”‚
â”‚  â”‚  â”œâ”€ GÃ©nÃ©rer JWT                                â”‚            â”‚
â”‚  â”‚  â””â”€ Set-Cookie: token                          â”‚            â”‚
â”‚  â”‚                                                 â”‚            â”‚
â”‚  â”‚ ğŸ‘¤ /me âœ¨ OPTIMISÃ‰E                             â”‚            â”‚
â”‚  â”‚  â”œâ”€ GET (credential: include)                  â”‚            â”‚
â”‚  â”‚  â”œâ”€ export const revalidate = 0 âœ¨             â”‚            â”‚
â”‚  â”‚  â”œâ”€ Query: .lean() âœ¨                          â”‚            â”‚
â”‚  â”‚  â”œâ”€ Header: Cache-Control: no-store âœ¨         â”‚            â”‚
â”‚  â”‚  â”œâ”€ POPULATE role, permissions                â”‚            â”‚
â”‚  â”‚  â””â”€ JSON { utilisateur, doitChangerMotDePasse}â”‚            â”‚
â”‚  â”‚                                                 â”‚            â”‚
â”‚  â”‚ ğŸšª /logout âœ¨ OPTIMISÃ‰E                         â”‚            â”‚
â”‚  â”‚  â”œâ”€ POST                                       â”‚            â”‚
â”‚  â”‚  â”œâ”€ Delete-Cookie: token                      â”‚            â”‚
â”‚  â”‚  â”œâ”€ Header: Cache-Control: no-store âœ¨        â”‚            â”‚
â”‚  â”‚  â”œâ”€ Header: Pragma: no-cache âœ¨               â”‚            â”‚
â”‚  â”‚  â””â”€ JSON { message: "DÃ©connexion rÃ©ussie" }  â”‚            â”‚
â”‚  â”‚                                                 â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           COUCHE BASE DE DONNÃ‰ES (MongoDB)                      â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ Collections:                         â”‚                      â”‚
â”‚  â”‚                                      â”‚                      â”‚
â”‚  â”‚ ğŸ‘¥ utilisateurs                     â”‚                      â”‚
â”‚  â”‚  â”œâ”€ _id: ObjectId                  â”‚                      â”‚
â”‚  â”‚  â”œâ”€ email: string (unique)         â”‚                      â”‚
â”‚  â”‚  â”œâ”€ motDePasse: string (hashed)   â”‚                      â”‚
â”‚  â”‚  â”œâ”€ prenom: string                â”‚                      â”‚
â”‚  â”‚  â”œâ”€ nom: string                   â”‚                      â”‚
â”‚  â”‚  â”œâ”€ role: ObjectId (ref)          â”‚                      â”‚
â”‚  â”‚  â”œâ”€ actif: boolean                â”‚                      â”‚
â”‚  â”‚  â””â”€ createdAt: Date               â”‚                      â”‚
â”‚  â”‚                                      â”‚                      â”‚
â”‚  â”‚ ğŸ‘” roles                            â”‚                      â”‚
â”‚  â”‚  â”œâ”€ _id: ObjectId                  â”‚                      â”‚
â”‚  â”‚  â”œâ”€ nom: string (admin/utilisateur)â”‚                      â”‚
â”‚  â”‚  â””â”€ permissions: [string]          â”‚                      â”‚
â”‚  â”‚                                      â”‚                      â”‚
â”‚  â”‚ Indexes:                             â”‚                      â”‚
â”‚  â”‚  â”œâ”€ utilisateurs.email (unique) âœ¨  â”‚                      â”‚
â”‚  â”‚  â”œâ”€ utilisateurs.role âœ¨           â”‚                      â”‚
â”‚  â”‚  â””â”€ roles.nom (unique) âœ¨          â”‚                      â”‚
â”‚  â”‚                                      â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ DIAGRAMME D'Ã‰TAT

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Ã‰TAT DE L'APPLICATION                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  DÃ‰MARRAGE  â”‚
                    â”‚ isLoading=T â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ checkAuth()     â”‚
                    â”‚ GET /api/auth/meâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                             â”‚
      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Token valide â”‚          â”‚ Token invalide  â”‚
      â”‚ user â‰  null  â”‚          â”‚ user = null     â”‚
      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                            â”‚
      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
      â”‚ AUTHENTIFIÃ‰            â”‚        â”‚
      â”‚ isLoading = false      â”‚        â”‚
      â”‚ isAuthenticated = true â”‚        â”‚
      â”‚ isLoggingOut = false   â”‚        â”‚
      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
            â”‚                            â”‚
            â”‚ Click DÃ©connexion         â”‚
            â”‚ (ou token expirÃ©)         â”‚
            â”‚                            â”‚
      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
      â”‚ DÃ‰CONNEXION EN COURS   â”‚        â”‚
      â”‚ isLoggingOut = true âœ¨ â”‚        â”‚
      â”‚ user = null âœ¨         â”‚        â”‚
      â”‚ Loader visible         â”‚        â”‚
      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
            â”‚                            â”‚
      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
      â”‚ POST /api/auth/logout  â”‚        â”‚
      â”‚ Delete cookie          â”‚        â”‚
      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
            â”‚                            â”‚
      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
      â”‚ router.push('/login')      â”‚    â”‚
      â”‚ Redirection               â”‚    â”‚
      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
            â”‚                            â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ NON AUTHENTIFIÃ‰  â”‚
            â”‚ Login Page       â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ Submit login form
                     â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ POST /api/auth/login  â”‚
            â”‚ Set-Cookie: token     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ RÃ©ussi
                     â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ RÃ©cupÃ©rer /api/auth/meâ”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â””â”€â”€â–º AUTHENTIFIÃ‰
```

---

## ğŸ§© COMPOSANTS & DÃ‰PENDANCES

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              STRUCTURE COMPOSANTS               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚ App Layout                                      â”‚
â”‚ â””â”€ AuthProvider                                 â”‚
â”‚    â”œâ”€ State: user, isLoading, isLoggingOut âœ¨   â”‚
â”‚    â”œâ”€ Context: useAuth()                        â”‚
â”‚    â””â”€ Children:                                 â”‚
â”‚       â”œâ”€ /dashboard                             â”‚
â”‚       â”‚  â””â”€ DashboardLayout                     â”‚
â”‚       â”‚     â”œâ”€ Sidebar                          â”‚
â”‚       â”‚     â”‚  â”œâ”€ logout() call                 â”‚
â”‚       â”‚     â”‚  â”œâ”€ isLoggingOut state âœ¨         â”‚
â”‚       â”‚     â”‚  â””â”€ Dropdown menu                 â”‚
â”‚       â”‚     â””â”€ Main Content (children)          â”‚
â”‚       â”‚        â”œâ”€ ProtectedRoute âœ¨             â”‚
â”‚       â”‚        â””â”€ Page content                  â”‚
â”‚       â”‚                                          â”‚
â”‚       â””â”€ /login                                 â”‚
â”‚          â””â”€ LoginForm                           â”‚
â”‚             â”œâ”€ login() call                     â”‚
â”‚             â””â”€ Error handling                   â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” SÃ‰CURITÃ‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        COUCHES DE SÃ‰CURITÃ‰                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                               â”‚
â”‚ 1. TOKEN SECURITY                             â”‚
â”‚    â”œâ”€ JWT signÃ© avec NEXTAUTH_SECRET         â”‚
â”‚    â”œâ”€ Stored in HttpOnly cookie             â”‚
â”‚    â”œâ”€ SameSite=Strict                        â”‚
â”‚    â””â”€ Expiration: 24h                        â”‚
â”‚                                               â”‚
â”‚ 2. API SECURITY                               â”‚
â”‚    â”œâ”€ VÃ©rifier token sur chaque requÃªte     â”‚
â”‚    â”œâ”€ Rate limiting sur /login               â”‚
â”‚    â”œâ”€ CORS configurÃ©                         â”‚
â”‚    â””â”€ No sensitive data in URL               â”‚
â”‚                                               â”‚
â”‚ 3. CACHE SECURITY                             â”‚
â”‚    â”œâ”€ Cache-Control: no-store âœ¨             â”‚
â”‚    â”œâ”€ Pragma: no-cache âœ¨                    â”‚
â”‚    â”œâ”€ Expires: 0 âœ¨                          â”‚
â”‚    â””â”€ revalidate = 0 âœ¨                      â”‚
â”‚                                               â”‚
â”‚ 4. ROUTE SECURITY                             â”‚
â”‚    â”œâ”€ ProtectedRoute âœ¨                      â”‚
â”‚    â”œâ”€ Role-based access control              â”‚
â”‚    â”œâ”€ Auto-redirect on invalid state        â”‚
â”‚    â””â”€ No render without auth                â”‚
â”‚                                               â”‚
â”‚ 5. STATE SECURITY                             â”‚
â”‚    â”œâ”€ isLoggingOut prÃ©vient actions âœ¨       â”‚
â”‚    â”œâ”€ Disabled buttons pendant logout âœ¨     â”‚
â”‚    â”œâ”€ user = null immÃ©diat âœ¨               â”‚
â”‚    â””â”€ Pas de donnÃ©es en localStorage        â”‚
â”‚                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš¡ OPTIMISATIONS APPLIQUÃ‰ES

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        PERFORMANCE OPTIMIZATIONS              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚ FRONT-END (Client)                           â”‚
â”‚ â”œâ”€ Optimistic updates: setUser(null) âœ¨     â”‚
â”‚ â”œâ”€ Early state transitions: isLoggingOut âœ¨ â”‚
â”‚ â”œâ”€ Button disabling: prevent double submit  â”‚
â”‚ â””â”€ Loading states: visual feedback          â”‚
â”‚                                              â”‚
â”‚ API (Server)                                 â”‚
â”‚ â”œâ”€ .lean() queries: read-only optimized âœ¨  â”‚
â”‚ â”œâ”€ No .toJSON(): direct serializable âœ¨     â”‚
â”‚ â”œâ”€ revalidate = 0: force dynamic âœ¨         â”‚
â”‚ â””â”€ Cache headers: no-store âœ¨               â”‚
â”‚                                              â”‚
â”‚ DATABASE (MongoDB)                           â”‚
â”‚ â”œâ”€ Indexed queries: email, role             â”‚
â”‚ â”œâ”€ Selective populate: only needed fields   â”‚
â”‚ â”œâ”€ Lean documents: plain objects            â”‚
â”‚ â””â”€ Connection pooling: reuse connections    â”‚
â”‚                                              â”‚
â”‚ NETWORK                                      â”‚
â”‚ â”œâ”€ Early redirect: before full page load   â”‚
â”‚ â”œâ”€ Minimal payload: only needed data        â”‚
â”‚ â”œâ”€ Gzip compression: enabled                â”‚
â”‚ â””â”€ CDN caching: static assets               â”‚
â”‚                                              â”‚
â”‚ RESULTS                                      â”‚
â”‚ â”œâ”€ Logout: 500ms â†’ 150ms (-70%) âœ¨         â”‚
â”‚ â”œâ”€ API /me: 200ms â†’ 80ms (-60%) âœ¨         â”‚
â”‚ â”œâ”€ No flash: YES âœ¨                        â”‚
â”‚ â””â”€ UX: Fluide et rÃ©actif âœ¨                â”‚
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¡ API ENDPOINTS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          API ENDPOINTS DOCUMENTATION            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚ ğŸ“ POST /api/auth/login                        â”‚
â”‚    Request:                                    â”‚
â”‚    {                                           â”‚
â”‚      email: "user@example.com",               â”‚
â”‚      motDePasse: "password123"                â”‚
â”‚    }                                           â”‚
â”‚                                                â”‚
â”‚    Response (200):                             â”‚
â”‚    {                                           â”‚
â”‚      success: true,                           â”‚
â”‚      doitChangerMotDePasse: false             â”‚
â”‚    }                                           â”‚
â”‚                                                â”‚
â”‚    Side effects:                               â”‚
â”‚    â”œâ”€ Set-Cookie: token=<jwt>                 â”‚
â”‚    â”œâ”€ Log action d'audit                      â”‚
â”‚    â””â”€ Update lastLogin timestamp              â”‚
â”‚                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚ ğŸ‘¤ GET /api/auth/me âœ¨ OPTIMISÃ‰E               â”‚
â”‚    Headers:                                    â”‚
â”‚    â”œâ”€ Cookie: token=<jwt> (auto)             â”‚
â”‚    â”œâ”€ Cache-Control: no-store âœ¨             â”‚
â”‚    â””â”€ revalidate: 0 âœ¨                       â”‚
â”‚                                                â”‚
â”‚    Response (200):                             â”‚
â”‚    {                                           â”‚
â”‚      utilisateur: {                           â”‚
â”‚        _id: "...",                            â”‚
â”‚        email: "user@example.com",             â”‚
â”‚        prenom: "Jean",                        â”‚
â”‚        nom: "Dupont",                         â”‚
â”‚        role: {                                â”‚
â”‚          nom: "utilisateur",                 â”‚
â”‚          permissions: [...]                  â”‚
â”‚        }                                       â”‚
â”‚      },                                        â”‚
â”‚      doitChangerMotDePasse: false             â”‚
â”‚    }                                           â”‚
â”‚                                                â”‚
â”‚    Performance:                                â”‚
â”‚    â”œâ”€ Time: ~80ms âœ¨                         â”‚
â”‚    â”œâ”€ Query: .lean() âœ¨                      â”‚
â”‚    â””â”€ Cache: no-store âœ¨                     â”‚
â”‚                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚ ğŸšª POST /api/auth/logout âœ¨ OPTIMISÃ‰E          â”‚
â”‚    Headers:                                    â”‚
â”‚    â”œâ”€ Cookie: token=<jwt> (auto)             â”‚
â”‚    â”œâ”€ Cache-Control: no-store âœ¨             â”‚
â”‚    â”œâ”€ Pragma: no-cache âœ¨                    â”‚
â”‚    â””â”€ Expires: 0 âœ¨                          â”‚
â”‚                                                â”‚
â”‚    Response (200):                             â”‚
â”‚    {                                           â”‚
â”‚      message: "DÃ©connexion rÃ©ussie."         â”‚
â”‚    }                                           â”‚
â”‚                                                â”‚
â”‚    Side effects:                               â”‚
â”‚    â”œâ”€ Delete-Cookie: token                    â”‚
â”‚    â”œâ”€ Log action d'audit                      â”‚
â”‚    â””â”€ Clear session data                      â”‚
â”‚                                                â”‚
â”‚    Performance:                                â”‚
â”‚    â”œâ”€ Time: ~80ms âœ¨                         â”‚
â”‚    â””â”€ Early return: no-store âœ¨              â”‚
â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ INTÃ‰GRATION COMPLÃˆTE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HOW IT ALL WORKS TOGETHER                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚ SCENARIO: User logs in and out              â”‚
â”‚                                             â”‚
â”‚ 1. User visits /login                       â”‚
â”‚    â”œâ”€ isLoading = true                     â”‚
â”‚    â”œâ”€ checkAuth() called                   â”‚
â”‚    â”œâ”€ GET /api/auth/me                     â”‚
â”‚    â””â”€ No valid token â†’ redirect /login     â”‚
â”‚                                             â”‚
â”‚ 2. User fills login form                    â”‚
â”‚    â”œâ”€ Click "Se connecter"                 â”‚
â”‚    â”œâ”€ POST /api/auth/login                 â”‚
â”‚    â”œâ”€ Server validates & sends token       â”‚
â”‚    â”œâ”€ Set-Cookie: token                    â”‚
â”‚    â””â”€ Response 200 OK                      â”‚
â”‚                                             â”‚
â”‚ 3. AuthContext updates                      â”‚
â”‚    â”œâ”€ checkAuth() called automatically      â”‚
â”‚    â”œâ”€ GET /api/auth/me (with cookie)      â”‚
â”‚    â”œâ”€ Response: user + role + permissions  â”‚
â”‚    â”œâ”€ setUser(userData)                    â”‚
â”‚    â”œâ”€ isLoading = false                    â”‚
â”‚    â””â”€ isAuthenticated = true               â”‚
â”‚                                             â”‚
â”‚ 4. DashboardLayout renders                  â”‚
â”‚    â”œâ”€ Checks isLoading (false, render)     â”‚
â”‚    â”œâ”€ Checks user (exists, render)         â”‚
â”‚    â”œâ”€ Sidebar loads with permissions       â”‚
â”‚    â””â”€ Main content displays                â”‚
â”‚                                             â”‚
â”‚ 5. User clicks "DÃ©connexion"               â”‚
â”‚    â”œâ”€ setIsLoggingOut(true) âœ¨ IMMÃ‰DIAT    â”‚
â”‚    â”œâ”€ setUser(null) âœ¨ IMMÃ‰DIAT            â”‚
â”‚    â”œâ”€ Loader visible, button disabled âœ¨   â”‚
â”‚    â”œâ”€ Sidebar "DÃ©connexion..." shows âœ¨    â”‚
â”‚    â””â”€ NO FLASH of old user âœ¨             â”‚
â”‚                                             â”‚
â”‚ 6. Logout API call (background)             â”‚
â”‚    â”œâ”€ POST /api/auth/logout                â”‚
â”‚    â”œâ”€ Delete-Cookie: token                 â”‚
â”‚    â””â”€ Response 200 OK                      â”‚
â”‚                                             â”‚
â”‚ 7. Navigation & redirect                    â”‚
â”‚    â”œâ”€ router.refresh()                     â”‚
â”‚    â”œâ”€ router.push('/login')                â”‚
â”‚    â””â”€ Full page redirect                   â”‚
â”‚                                             â”‚
â”‚ 8. Back to step 1                           â”‚
â”‚    â”œâ”€ User on /login                       â”‚
â”‚    â”œâ”€ checkAuth() finds no token           â”‚
â”‚    â””â”€ Login page renders                   â”‚
â”‚                                             â”‚
â”‚ TOTAL TIME: 150-200ms âœ¨                   â”‚
â”‚ WITH FLASH: 0% âœ¨                          â”‚
â”‚ USER EXPERIENCE: FLUIDE âœ¨                 â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

